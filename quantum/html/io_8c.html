<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.7"/>
<title>Quantum Computer Outreach Project: dspic33e/qcomp-sim-c.X/io.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Quantum Computer Outreach Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.7 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_cae82029997ea84f6afb13b39521d0ca.html">dspic33e</a></li><li class="navelem"><a class="el" href="dir_6662ae699bb746dfe74afbdc036e2b7f.html">qcomp-sim-c.X</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">io.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Contains all the functions for reading buttons and writing to LEDs.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="io_8h_source.html">io.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="time_8h_source.html">time.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="spi_8h_source.html">spi.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for io.c:</div>
<div class="dyncontent">
<div class="center"><img src="io_8c__incl.png" border="0" usemap="#dspic33e_2qcomp-sim-c_8X_2io_8c" alt=""/></div>
<map name="dspic33e_2qcomp-sim-c_8X_2io_8c" id="dspic33e_2qcomp-sim-c_8X_2io_8c">
</map>
</div>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:af281425e62298bac2df0fbe8690a4844"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="af281425e62298bac2df0fbe8690a4844"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>PERIOD</b>&#160;&#160;&#160;500000</td></tr>
<tr class="separator:af281425e62298bac2df0fbe8690a4844"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:af3f93a224b1c0993b55cb3534237300f"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="io_8c.html#af3f93a224b1c0993b55cb3534237300f">led_color_int</a> (int device, int R, int G, int B)</td></tr>
<tr class="memdesc:af3f93a224b1c0993b55cb3534237300f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Takes led number &amp; RGB -&gt; returns integer for sending via SPI to set the LED.  <a href="#af3f93a224b1c0993b55cb3534237300f">More...</a><br /></td></tr>
<tr class="separator:af3f93a224b1c0993b55cb3534237300f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:accd4a9c9edd862d4e50bf6a3740d9b82"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="io_8c.html#accd4a9c9edd862d4e50bf6a3740d9b82">setup_io</a> (void)</td></tr>
<tr class="memdesc:accd4a9c9edd862d4e50bf6a3740d9b82"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set up LEDs and buttons on port D.  <a href="#accd4a9c9edd862d4e50bf6a3740d9b82">More...</a><br /></td></tr>
<tr class="separator:accd4a9c9edd862d4e50bf6a3740d9b82"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a64653c452ab199760e9cdd6bdbbeeb76"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="io_8c.html#a64653c452ab199760e9cdd6bdbbeeb76">__attribute__</a> ((__interrupt__, no_auto_psv))</td></tr>
<tr class="memdesc:a64653c452ab199760e9cdd6bdbbeeb76"><td class="mdescLeft">&#160;</td><td class="mdescRight">Interrupt service routine for timer 4.  <a href="#a64653c452ab199760e9cdd6bdbbeeb76">More...</a><br /></td></tr>
<tr class="separator:a64653c452ab199760e9cdd6bdbbeeb76"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a577efab9f22ad4ed19f6a728100821a7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="io_8c.html#a577efab9f22ad4ed19f6a728100821a7">start_strobe</a> ()</td></tr>
<tr class="memdesc:a577efab9f22ad4ed19f6a728100821a7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set LEDs flashing.  <a href="#a577efab9f22ad4ed19f6a728100821a7">More...</a><br /></td></tr>
<tr class="separator:a577efab9f22ad4ed19f6a728100821a7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abf2ffa488fe1b7213a84d0cd00fbea03"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="abf2ffa488fe1b7213a84d0cd00fbea03"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="io_8c.html#abf2ffa488fe1b7213a84d0cd00fbea03">stop_strobe</a> ()</td></tr>
<tr class="memdesc:abf2ffa488fe1b7213a84d0cd00fbea03"><td class="mdescLeft">&#160;</td><td class="mdescRight">Stop LEDs flashing. <br /></td></tr>
<tr class="separator:abf2ffa488fe1b7213a84d0cd00fbea03"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a89d0c0b5eee8cda66adde23080acd0bd"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="io_8c.html#a89d0c0b5eee8cda66adde23080acd0bd">set_strobe</a> (int color, int state)</td></tr>
<tr class="memdesc:a89d0c0b5eee8cda66adde23080acd0bd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set an LED strobing.  <a href="#a89d0c0b5eee8cda66adde23080acd0bd">More...</a><br /></td></tr>
<tr class="separator:a89d0c0b5eee8cda66adde23080acd0bd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8abb07633ea7d3ab2bd8c9d082feb65a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="io_8c.html#a8abb07633ea7d3ab2bd8c9d082feb65a">toggle_strobe</a> (int color)</td></tr>
<tr class="memdesc:a8abb07633ea7d3ab2bd8c9d082feb65a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Toggle LED strobe.  <a href="#a8abb07633ea7d3ab2bd8c9d082feb65a">More...</a><br /></td></tr>
<tr class="separator:a8abb07633ea7d3ab2bd8c9d082feb65a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a31fb0fd759d90940706a83347642f59e"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="io_8c.html#a31fb0fd759d90940706a83347642f59e">set_led</a> (int color, int state)</td></tr>
<tr class="memdesc:a31fb0fd759d90940706a83347642f59e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Turn a particular LED on or off.  <a href="#a31fb0fd759d90940706a83347642f59e">More...</a><br /></td></tr>
<tr class="separator:a31fb0fd759d90940706a83347642f59e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5c2b76dada8dc8a2d65249074843867c"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="io_8c.html#a5c2b76dada8dc8a2d65249074843867c">read_btn</a> (int btn)</td></tr>
<tr class="memdesc:a5c2b76dada8dc8a2d65249074843867c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Read the state of a push button.  <a href="#a5c2b76dada8dc8a2d65249074843867c">More...</a><br /></td></tr>
<tr class="separator:a5c2b76dada8dc8a2d65249074843867c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4bf53abfd4d628a2791bf1783de96b27"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a4bf53abfd4d628a2791bf1783de96b27"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="io_8c.html#a4bf53abfd4d628a2791bf1783de96b27">leds_off</a> (void)</td></tr>
<tr class="memdesc:a4bf53abfd4d628a2791bf1783de96b27"><td class="mdescLeft">&#160;</td><td class="mdescRight">Turn all the LEDs off. <br /></td></tr>
<tr class="separator:a4bf53abfd4d628a2791bf1783de96b27"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a12adda62b67a14e911149c76376ce295"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="io_8c.html#a12adda62b67a14e911149c76376ce295">flash_led</a> (int color, int number)</td></tr>
<tr class="memdesc:a12adda62b67a14e911149c76376ce295"><td class="mdescLeft">&#160;</td><td class="mdescRight">Flash LED a number of times.  <a href="#a12adda62b67a14e911149c76376ce295">More...</a><br /></td></tr>
<tr class="separator:a12adda62b67a14e911149c76376ce295"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a24a09a687c0efdba91ec54b2853b2260"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="io_8c.html#a24a09a687c0efdba91ec54b2853b2260">flash_all</a> (int number)</td></tr>
<tr class="memdesc:a24a09a687c0efdba91ec54b2853b2260"><td class="mdescLeft">&#160;</td><td class="mdescRight">Flash all the LEDs a number of times.  <a href="#a24a09a687c0efdba91ec54b2853b2260">More...</a><br /></td></tr>
<tr class="separator:a24a09a687c0efdba91ec54b2853b2260"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4fb3be99e715a9a88ba1d1a670ea0ab4"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="io_8c.html#a4fb3be99e715a9a88ba1d1a670ea0ab4">write_display_driver</a> (int data)</td></tr>
<tr class="memdesc:a4fb3be99e715a9a88ba1d1a670ea0ab4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Turn on an LED via the external display driver.  <a href="#a4fb3be99e715a9a88ba1d1a670ea0ab4">More...</a><br /></td></tr>
<tr class="separator:a4fb3be99e715a9a88ba1d1a670ea0ab4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaf115833d4313aa7a9f099a4d7bea685"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="io_8c.html#aaf115833d4313aa7a9f099a4d7bea685">TLC591x_mode_switch</a> (int mode)</td></tr>
<tr class="memdesc:aaf115833d4313aa7a9f099a4d7bea685"><td class="mdescLeft">&#160;</td><td class="mdescRight">Switch between normal and special mode.  <a href="#aaf115833d4313aa7a9f099a4d7bea685">More...</a><br /></td></tr>
<tr class="separator:aaf115833d4313aa7a9f099a4d7bea685"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adb3900100235e97827ad327ea028bd1d"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="io_8c.html#adb3900100235e97827ad327ea028bd1d">read_external_buttons</a> ()</td></tr>
<tr class="memdesc:adb3900100235e97827ad327ea028bd1d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Read external buttons.  <a href="#adb3900100235e97827ad327ea028bd1d">More...</a><br /></td></tr>
<tr class="separator:adb3900100235e97827ad327ea028bd1d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a3240a0ec7160d6bae6cc4a7bab8494c7"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structLED__GLOBAL.html">LED_GLOBAL</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="io_8c.html#a3240a0ec7160d6bae6cc4a7bab8494c7">led_global</a> = {0}</td></tr>
<tr class="separator:a3240a0ec7160d6bae6cc4a7bab8494c7"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Contains all the functions for reading buttons and writing to LEDs. </p>
<dl class="section author"><dt>Author</dt><dd>J Scott </dd></dl>
<dl class="section date"><dt>Date</dt><dd>8/11/18 </dd></dl>
</div><h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a64653c452ab199760e9cdd6bdbbeeb76"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void __attribute__ </td>
          <td>(</td>
          <td class="paramtype">(__interrupt__, no_auto_psv)&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Interrupt service routine for timer 4. </p>
<dl class="section note"><dt>Note</dt><dd>I have no idea what this line means... </dd></dl>

</div>
</div>
<a class="anchor" id="a24a09a687c0efdba91ec54b2853b2260"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void flash_all </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>number</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Flash all the LEDs a number of times. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">number</td><td></td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a12adda62b67a14e911149c76376ce295"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void flash_led </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>color</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>number</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Flash LED a number of times. </p>
<p>Flash one LED a number of times. </p>

</div>
</div>
<a class="anchor" id="af3f93a224b1c0993b55cb3534237300f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int led_color_int </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>device</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>R</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>B</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Takes led number &amp; RGB -&gt; returns integer for sending via SPI to set the LED. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">device</td><td>input LED number to change </td></tr>
    <tr><td class="paramname">R</td><td>red value between 0 &amp; 1 </td></tr>
    <tr><td class="paramname">G</td><td>green value between 0 &amp; 1 </td></tr>
    <tr><td class="paramname">B</td><td>blue value between 0 &amp; 1 </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Returns int to be sent to LED Driver </dd></dl>
<p>convention RGB -&gt; 000</p>
<p>Each LED takes 3 lines, assumes there are no gaps between LED channels "device" goes between 0 to 2^n -1 </p>

</div>
</div>
<a class="anchor" id="a5c2b76dada8dc8a2d65249074843867c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int read_btn </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>btn</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Read the state of a push button. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">btn</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>How well do you know C </dd></dl>

</div>
</div>
<a class="anchor" id="adb3900100235e97827ad327ea028bd1d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int read_external_buttons </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Read external buttons. </p>
<p>The external buttons are interfaced to the microcontroller via a shift register. Data is shifted in a byte at a time using the SPI 3 module. The sequence to read the buttons is as follows:</p>
<p>1) Momentarily bring SH low to latch button data into the shift registers 2) Bring CLK_INH low to enable the clock input on the shift register 3) Start the SPI 3 clock and read data in via the SDI 3 line</p>
<p>The control lines SH and CLK_INH are on port D</p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000003">Todo:</a></b></dt><dd>read buttons </dd></dl>

</div>
</div>
<a class="anchor" id="a31fb0fd759d90940706a83347642f59e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int set_led </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>color</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>state</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Turn a particular LED on or off. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">color</td><td></td></tr>
    <tr><td class="paramname">state</td><td></td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a89d0c0b5eee8cda66adde23080acd0bd"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void set_strobe </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>color</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>state</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set an LED strobing. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">color</td><td></td></tr>
    <tr><td class="paramname">state</td><td></td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="accd4a9c9edd862d4e50bf6a3740d9b82"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int setup_io </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set up LEDs and buttons on port D. </p>
<p>&lt; Set port c digital for spi3</p>
<p>Set the OE pin high</p>
<p>Set OE(ED2) pin</p>
<p>Set the SH pin high</p>
<p>Set SH pin</p>
<p>set CLK_INH high while buttons are pressed </p>

</div>
</div>
<a class="anchor" id="a577efab9f22ad4ed19f6a728100821a7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void start_strobe </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set LEDs flashing. </p>
<p>Set LEDs flashing indefinitely. </p>

</div>
</div>
<a class="anchor" id="aaf115833d4313aa7a9f099a4d7bea685"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int TLC591x_mode_switch </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>mode</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Switch between normal and special mode. </p>
<p>The mode switch for the TLC591x chip is a bit tricky because it involves synchronising the control lines <a class="el" href="io_8h.html#aa4d6abc7b58eb11e517993df83b7f0f7" title="Control for TLC591x chip on Port D. ">LE(ED1)</a> and OE(ED2) on Port D with the SPI 1 clock. To initiate a mode switch, OE(ED2) must be brought low for one clock cycle, and then the value of <a class="el" href="io_8h.html#aa4d6abc7b58eb11e517993df83b7f0f7" title="Control for TLC591x chip on Port D. ">LE(ED1)</a> two clock cycles later determines the new mode. See the diagrams on page 19 of the datasheet</p>
<p>So long as the timing is not strict, we can probably implement the mode switch by starting a non-blocking transfer of 1 byte to the device (which starts the SPI 1 clock), followed by clearing OE(ED2) momentarily and then setting the value of <a class="el" href="io_8h.html#aa4d6abc7b58eb11e517993df83b7f0f7" title="Control for TLC591x chip on Port D. ">LE(ED1)</a> as required. So long as those two things happen before the SPI 1 clock finishes the procedure will probably work. (The reason is the lack of max timing parameters on page 9 for the setup and hold time for ED1 and ED2, which can therefore presumably be longer than one clock cycle.) </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">mode</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000002">Todo:</a></b></dt><dd>mode switcher for LED Driver </dd></dl>

</div>
</div>
<a class="anchor" id="a8abb07633ea7d3ab2bd8c9d082feb65a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void toggle_strobe </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>color</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Toggle LED strobe. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">color</td><td></td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a4fb3be99e715a9a88ba1d1a670ea0ab4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int write_display_driver </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>data</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Turn on an LED via the external display driver. </p>
<p>Send a byte to the display driver.</p>
<p>On power on, the chip (TLC591x) is in normal mode which means that the clocked bytes sent to the chip set which LEDs are on and which are off (as opposed to setting the current of the LEDs)</p>
<p>To write to the device, use the SPI module to write a byte to the SDI 1 pin on the chip. Then momentarily set the <a class="el" href="io_8h.html#aa4d6abc7b58eb11e517993df83b7f0f7" title="Control for TLC591x chip on Port D. ">LE(ED1)</a> pin to latch the data onto the output register. Finally, bring the OE(ED2) pin low to enable the current sinking to turn on the LEDs. See the timing diagram on page 17 of the datasheet for details.</p>
<p><a class="el" href="io_8h.html#aa4d6abc7b58eb11e517993df83b7f0f7" title="Control for TLC591x chip on Port D. ">LE(ED1)</a> and OE(ED2) will be on Port D </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">data</td><td>the byte to send to LED driver </td></tr>
  </table>
  </dd>
</dl>
<p>Set <a class="el" href="io_8h.html#aa4d6abc7b58eb11e517993df83b7f0f7" title="Control for TLC591x chip on Port D. ">LE(ED1)</a> pin</p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000001">Todo:</a></b></dt><dd>How long should this be? </dd></dl>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a class="anchor" id="a3240a0ec7160d6bae6cc4a7bab8494c7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structLED__GLOBAL.html">LED_GLOBAL</a> led_global = {0}</td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">led_global</td><td>Global LED strobing state parameter </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.7
</small></address>
</body>
</html>
